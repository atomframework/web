<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.27.2">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/onyxframework/rest">
  <title>README - github.com/onyxframework/rest</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="github.com/onyxframework/rest/HTTP" data-name="http">
      <a href="HTTP.html">HTTP</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/HTTP/Request" data-name="http::request">
      <a href="HTTP/Request.html">Request</a>
      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/HTTP/Server" data-name="http::server">
      <a href="HTTP/Server.html">Server</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/HTTP/Server/Response" data-name="http::server::response">
      <a href="HTTP/Server/Response.html">Response</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx" data-name="onyx">
      <a href="Onyx.html">Onyx</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST" data-name="onyx::rest">
      <a href="Onyx/REST.html">REST</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/CORS" data-name="onyx::rest::cors">
      <a href="Onyx/REST/CORS.html">CORS</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Error" data-name="onyx::rest::error(code)">
      <a href="Onyx/REST/Error.html">Error</a>
      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST/Errors" data-name="onyx::rest::errors">
      <a href="Onyx/REST/Errors.html">Errors</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Errors/NotFound" data-name="onyx::rest::errors::notfound">
      <a href="Onyx/REST/Errors/NotFound.html">NotFound</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Errors/ParamsError" data-name="onyx::rest::errors::paramserror">
      <a href="Onyx/REST/Errors/ParamsError.html">ParamsError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST/Loggers" data-name="onyx::rest::loggers">
      <a href="Onyx/REST/Loggers.html">Loggers</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Loggers/Standard" data-name="onyx::rest::loggers::standard">
      <a href="Onyx/REST/Loggers/Standard.html">Standard</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST/Renderers" data-name="onyx::rest::renderers">
      <a href="Onyx/REST/Renderers.html">Renderers</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Renderers/JSON" data-name="onyx::rest::renderers::json">
      <a href="Onyx/REST/Renderers/JSON.html">JSON</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/RequestID" data-name="onyx::rest::requestid">
      <a href="Onyx/REST/RequestID.html">RequestID</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Rescuer" data-name="onyx::rest::rescuer(t)">
      <a href="Onyx/REST/Rescuer.html">Rescuer</a>
      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST/Rescuers" data-name="onyx::rest::rescuers">
      <a href="Onyx/REST/Rescuers.html">Rescuers</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Rescuers/Standard" data-name="onyx::rest::rescuers::standard">
      <a href="Onyx/REST/Rescuers/Standard.html">Standard</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST/Router" data-name="onyx::rest::router">
      <a href="Onyx/REST/Router.html">Router</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Router/DuplicateRouteError" data-name="onyx::rest::router::duplicaterouteerror">
      <a href="Onyx/REST/Router/DuplicateRouteError.html">DuplicateRouteError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Server" data-name="onyx::rest::server">
      <a href="Onyx/REST/Server.html">Server</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p>&lt;a href="https://onyxframework.org">&lt;img align="right" width="147" height="147" src="https://onyxframework.org/img/logo.svg">&lt;/a></p>

<h1>Onyx::REST</h1>

<p><a href="https://crystal-lang.org/" target="_blank"><img src="https://img.shields.io/badge/built%20with-crystal-000000.svg?style=flat-square" alt="Built with Crystal"/></a>
<a href="https://travis-ci.org/onyxframework/rest" target="_blank"><img src="https://img.shields.io/travis/onyxframework/rest/master.svg?style=flat-square" alt="Travis CI build"/></a>
<a href="https://api.onyxframework.org/rest" target="_blank"><img src="https://img.shields.io/badge/api_docs-online-brightgreen.svg?style=flat-square" alt="API docs"/></a>
<a href="https://github.com/onyxframework/rest/releases" target="_blank"><img src="https://img.shields.io/github/release/onyxframework/rest.svg?style=flat-square" alt="Latest release"/></a></p>

<p>A REST API framework for <a href="https://crystal-lang.org" target="_blank">Crystal</a>.</p>

<h2>About</h2>

<p>Onyx::REST is an opinionated REST API framework — basically, a collection of HTTP handlers and the default <a href="https://crystal-lang.org/api/HTTP/Server.html" target="_blank">HTTP::Server</a> wrapper. It's thoroughly designed to be as much beginner-friendly as possible, yet scale with the developer's knowledge of the <a href="https://crystal-lang.org" target="_blank">Crystal Language</a>. The framework itself is <a href="https://en.wikipedia.org/wiki/SOLID" target="_blank">SOLID</a> (excluding some simplifications to reduce boilerplate code), modular (there can be multiple servers in one application and there are no top-level macros by default) and respects configuration over convention.</p>

<h3>Benchmarks</h3>

<p><a href="https://public.chartblocks.com/c/5c273d8b3ba0f6ef7c65d832?t=b938d2bf4965222" target="_blank"><img src="https://d3ugvbs94d921r.cloudfront.net/5c273d8b3ba0f6ef7c65d832.svg?t=b938d2bf4965222&v=3318a7b2" alt="Benchmarks"/></a></p>

<p><em>Source: <a href="https://github.com/the-benchmarker/web-frameworks/blob/2dc801850d6cfed91333cf9af87f7b2c363d9e38/README.md" target="_blank">https://github.com/the-benchmarker/web-frameworks@2dc801850d6cfed91333cf9af87f7b2c363d9e38</a></em></p>

<h2>Installation</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  onyx-rest:
    github: onyxframework/rest
    version: ~> 0.5.0</code></pre>

<p>This shard follows <a href="http://semver.org/" target="_blank">Semantic Versioning v2.0.0</a>, so check <a href="https://github.com/onyxframework/rest/releases" target="_blank">releases</a> and change the <code>version</code> accordingly. Please visit <a href="https://github.com/crystal-lang/shards" target="_blank">github.com/crystal-lang/shards</a> to know more about Crystal shards.</p>

<h2>Usage</h2>

<p>This is the most basic example of an application written with Onyx::REST:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx-rest&quot;</span>

router <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Router</span>.<span class="k">new</span> <span class="k">do</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span>
    <span class="s">&quot;Hello Onyx!&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>(router)
server.bind_tcp(<span class="n">5000</span>)
server.listen</code></pre>

<pre><code class="language-console">INFO [14:04:31.493] ⬛ Onyx::REST::Server is listening at http://127.0.0.1:5000
INFO [14:04:34.082] ⬛ Onyx::REST::Server is shutting down!</code></pre>

<pre><code class="language-console">$ curl http://localhost:5000
Hello Onyx!</code></pre>

<h3>Handlers</h3>

<p>Fundamentally, every Onyx::REST application is a stack of HTTP handlers passed to the <a href="https://api.onyxframework.org/rest/Onyx/REST/Server.html" target="_blank">Onyx::REST::Server</a>. To add new functionality, you add new handlers to the stack. There is a number of implemented handlers which fit the most common REST application needs:</p>

<ul><li><a href="https://api.onyxframework.org/rest/Onyx/REST/Router.html" target="_blank">Onyx::REST::Router</a> — routes the request to a proc</li><li><a href="https://api.onyxframework.org/rest/Onyx/REST/CORS.html" target="_blank">Onyx::REST::CORS</a> — Cross Origin Resource Sharing handler</li><li><a href="https://api.onyxframework.org/rest/Onyx/REST/RequestID.html" target="_blank">Onyx::REST::RequestID</a> — adds ID to the request</li><li>Rescuers — rescue unhandled errors</li><ul><li><a href="https://api.onyxframework.org/rest/Onyx/REST/Rescuers/Standard.html" target="_blank">Onyx::REST::Rescuers::Standard</a> — rescues errors and logs them colorfully to a standard Crystal logger</li></ul><li>Loggers — log requests</li><ul><li><a href="https://api.onyxframework.org/rest/Onyx/REST/Loggers/Standard.html" target="_blank">Onyx::REST::Loggers::Standard</a> — logs requests colorfully to a standard Crystal logger</li></ul><li>Renderers — render responses</li><ul><li><a href="https://api.onyxframework.org/rest/Onyx/REST/Renderers/JSON.html" target="_blank">Onyx::REST::Renderers::JSON</a> — renders to JSON</li></ul></ul>

<h4>Request ID</h4>

<p>The built-in <a href="https://api.onyxframework.org/rest/Onyx/REST/RequestID.html" target="_blank">Onyx::REST::RequestID</a> adds a random UUID to the <a href="https://api.onyxframework.org/rest/HTTP/Request.html" target="_blank">Request instance</a>:</p>

<pre><code class="language-crystal">request_id <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">RequestID</span>.<span class="k">new</span>
handlers <span class="o">=</span> [request_id, router]
server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>(handlers)
<span class="c"># ditto</span></code></pre>

<pre><code class="language-console">$ curl http://127.0.0.1:5000
X-Request-ID: 23bac83d-4894-4e6c-b007-7785ff73d684</code></pre>

<h4>Logging requests</h4>

<p>Built-in requests logger is pretty easy to use:</p>

<pre><code class="language-crystal">logger <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Loggers</span><span class="t">::</span><span class="t">Standard</span>.<span class="k">new</span>
handlers <span class="o">=</span> [request_id, logger, rescuer]
<span class="c"># ditto</span></code></pre>

<pre><code class="language-console">INFO [14:04:32.578] [4821be8e]      GET / 200 127μs
INFO [14:04:36.718] [6ec8d538]     POST /users 201 1.579ms
INFO [14:04:39.912] [60c5d1ed]      GET /unknown 404 77μs</code></pre>

<h4>Rescuing unhandled errors</h4>

<p>If an unhandled error raised somewhere during processing the request, the Crystal process doesn't crash and the user sees <code>500 Internal Server Error</code>, but the error's backtrace is put directly into <code>STDERR</code> and the handlers stack is exited. Therefore, it's a good idea to add a rescuer handler into the stack. For example, default <a href="https://api.onyxframework.org/rest/Onyx/REST/Rescuers/Standard.html" target="_blank">Onyx::REST::Rescuers::Standard</a> logs the error into a standard Crystal logger:</p>

<pre><code class="language-crystal">router.get <span class="s">&quot;/error&quot;</span> <span class="k">do</span> <span class="o">|</span>env<span class="o">|</span>
  raise <span class="s">&quot;Oops&quot;</span>
<span class="k">end</span>

rescuer <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Rescuers</span><span class="t">::</span><span class="t">Standard</span>.<span class="k">new</span>
handlers <span class="o">=</span> [request_id, logger, rescuer, router]</code></pre>

<pre><code class="language-console">INFO [14:04:32.578] [8e0c113f]  ERROR  Oops

Oops (Exception)
  from spec/json_server.cr:23:9 in '->'
  from src/onyx-rest/router.cr:255:3 in '->'
  from src/onyx-rest/router.cr:255:3 in 'call'
  from /usr/share/crystal/src/http/server/handler.cr:24:7 in 'call_next'
  from src/onyx-rest/rescuer.cr:20:5 in 'call'
  from /usr/share/crystal/src/http/server/handler.cr:24:7 in 'call_next'
  from src/onyx-rest/rescuer.cr:20:5 in 'call'
  from /usr/share/crystal/src/http/server/handler.cr:24:7 in 'call_next'
  from src/onyx-rest/loggers/standard.cr:73:11 in 'call'

INFO [14:04:32.578] [8e0c113f]     GET /error 500 1.890ms</code></pre>

<p>You can also specify the "next" handler for a rescuer, so it calls it directly upon rescuing:</p>

<pre><code class="language-crystal">renderer <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Renderers</span><span class="t">::</span><span class="t">JSON</span>.<span class="k">new</span>
rescuer <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Rescuers</span><span class="t">::</span><span class="t">Standard</span>.<span class="k">new</span>(renderer)
<span class="c"># ditto</span></code></pre>

<p>And the result would be:</p>

<pre><code class="language-json">{
  "error": {
    "class": "UnhandledServerError",
    "message": "Unhandled server error. If you are the application owner, see the logs for details",
    "code": 500
  }
}</code></pre>

<h3>REST errors</h3>

<p>There is a <a href="https://api.onyxframework.org/rest/Onyx/REST/Error.html" target="_blank"><code>Onyx::REST::Error</code></a> abstract class which defines an <strong>expected</strong> error, for example:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">UserNotFound</span> <span class="o">&lt;</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Error</span>(<span class="n">404</span>)
  <span class="k">def</span> <span class="m">initialize</span>(id)
    <span class="k">super</span>(<span class="s">&quot;User not found with id </span><span class="i">#{</span>id<span class="i">}</span><span class="s">&quot;</span>)
  <span class="k">end</span>
<span class="k">end</span>

router.get <span class="s">&quot;/users/:id&quot;</span> <span class="k">do</span> <span class="o">|</span>env<span class="o">|</span>
  id <span class="o">=</span> env.request.path_params[<span class="s">&quot;id&quot;</span>].to_i?
  raise <span class="t">UserNotFound</span>.<span class="k">new</span>(id) <span class="k">unless</span> <span class="t">Models</span><span class="t">::</span><span class="t">User</span>.find(id)
<span class="k">end</span></code></pre>

<p>These errors are typically rescued by the router and renderers (no need for a <a href="https://api.onyxframework.org/rest/Onyx/REST/Rescuer.html" target="_blank">Rescuer</a> in this case):</p>

<pre><code class="language-console">$ curl http://localhost:5000/users/42
404 User not found with id 42</code></pre>

<h3>Params</h3>

<p>Onyx::REST has a built-in rescuer for <a href="https://github.com/vladfaust/http-params-serializable" target="_blank"><code>HTTP::Params::Serializable</code></a>, which makes defining typed params a piece of cake:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx-rest&quot;</span>
<span class="k">require</span> <span class="s">&quot;onyx-rest/ext/http-params-serializable&quot;</span>

<span class="k">struct</span> <span class="t">FindUserParams</span>
  <span class="k">include</span> <span class="t">HTTP</span><span class="t">::</span><span class="t">Params</span><span class="t">::</span><span class="t">Serializable</span>

  getter name : <span class="t">String</span>
  getter age : <span class="t">Int32</span>
<span class="k">end</span>

router.get <span class="s">&quot;/users&quot;</span> <span class="k">do</span> <span class="o">|</span>env<span class="o">|</span>
  params <span class="o">=</span> <span class="t">FindUserParams</span>.<span class="k">new</span>(env.request.query)
  users <span class="o">=</span> <span class="t">Models</span><span class="t">::</span><span class="t">Users</span>.find(name: params.name, age: params.age)

  <span class="k">if</span> user <span class="o">=</span> users[<span class="n">0</span>]?
    <span class="s">&quot;</span><span class="i">#{</span>user.first_name<span class="i">}</span><span class="s"> </span><span class="i">#{</span>user.last_name<span class="i">}</span><span class="s">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c"># Standard rescuers rescues `Exception`s</span>
rescuer <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Rescuers</span><span class="t">::</span><span class="t">Standard</span>.<span class="k">new</span>

<span class="c"># Params rescuer rescues only Params errors and skips other `Exception`s</span>
params_rescuer <span class="o">=</span> <span class="t">HTTP</span><span class="t">::</span><span class="t">Params</span><span class="t">::</span><span class="t">Serializable</span><span class="t">::</span><span class="t">Rescuer</span>.<span class="k">new</span>

server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>([rescuer, params_rescuer, router])</code></pre>

<pre><code class="language-console">$ curl http://localhost:5000/users?age=foo
400 Parameter "age" can't be cast from "foo" to Int32
$ curl http://localhost:5000/users?age=22
Vlad Faust</code></pre>

<h2>Contributing</h2>

<ol><li>Fork it ( https://github.com/onyxframework/rest/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'Add some feature')</li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/vladfaust" target="_blank">Vlad Faust</a> - creator and maintainer</li></ul>

<h2>Licensing</h2>

<p>This software is licensed under <a href="LICENSE" target="_blank">BSD 3-Clause License</a>.</p>

<p><a href="https://opensource.org/licenses/BSD-3-Clause" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Opensource.svg/100px-Opensource.svg.png" alt="Open Source Initiative"/></a></p>
</div>
</body>
</html>
