<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.27.2">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/onyxframework/rest">
  <title>README - github.com/onyxframework/rest</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="github.com/onyxframework/rest/HTTP" data-name="http">
      <a href="HTTP.html">HTTP</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/rest/HTTP/Server" data-name="http::server">
      <a href="HTTP/Server.html">Server</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/HTTP/Server/Response" data-name="http::server::response">
      <a href="HTTP/Server/Response.html">Response</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx" data-name="onyx">
      <a href="Onyx.html">Onyx</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST" data-name="onyx::rest">
      <a href="Onyx/REST.html">REST</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Action" data-name="onyx::rest::action">
      <a href="Onyx/REST/Action.html">Action</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Error" data-name="onyx::rest::error(code)">
      <a href="Onyx/REST/Error.html">Error</a>
      
    </li>
  
  <li class="parent " data-id="github.com/onyxframework/rest/Onyx/REST/Renderers" data-name="onyx::rest::renderers">
      <a href="Onyx/REST/Renderers.html">Renderers</a>
      
        <ul>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Renderers/JSON" data-name="onyx::rest::renderers::json">
      <a href="Onyx/REST/Renderers/JSON.html">JSON</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Renderers/Text" data-name="onyx::rest::renderers::text">
      <a href="Onyx/REST/Renderers/Text.html">Text</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/Rescuer" data-name="onyx::rest::rescuer">
      <a href="Onyx/REST/Rescuer.html">Rescuer</a>
      
    </li>
  
  <li class=" " data-id="github.com/onyxframework/rest/Onyx/REST/View" data-name="onyx::rest::view">
      <a href="Onyx/REST/View.html">View</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p>&lt;a href="https://onyxframework.org">&lt;img width="100" height="100" src="https://onyxframework.org/img/logo.svg">&lt;/a></p>

<h1>Onyx::REST</h1>

<p><a href="https://crystal-lang.org/" target="_blank"><img src="https://img.shields.io/badge/built%20with-crystal-000000.svg?style=flat-square" alt="Built with Crystal"/></a>
<a href="https://travis-ci.org/onyxframework/rest" target="_blank"><img src="https://img.shields.io/travis/onyxframework/rest/master.svg?style=flat-square" alt="Travis CI build"/></a>
<a href="https://api.onyxframework.org/rest" target="_blank"><img src="https://img.shields.io/badge/api_docs-online-brightgreen.svg?style=flat-square" alt="API docs"/></a>
<a href="https://github.com/onyxframework/rest/releases" target="_blank"><img src="https://img.shields.io/github/release/onyxframework/rest.svg?style=flat-square" alt="Latest release"/></a></p>

<p>A REST API framework for <a href="https://crystal-lang.org" target="_blank">Crystal</a>.</p>

<h2>Supporters ‚ù§Ô∏è</h2>

<p>Thanks to all my patrons, I can continue working on beautiful Open Source Software! üôè</p>

<p><a href="https://github.com/ljuti" target="_blank">Lauri Jutila</a>, <a href="https://seendex.ru" target="_blank">Alexander Maslov</a>, Dainel Vera</p>

<p><em>You can become a patron too in exchange of prioritized support and other perks</em></p>

<p>&lt;a href="https://www.patreon.com/vladfaust">&lt;img height="50" src="https://onyxframework.org/img/patreon-button.svg">&lt;/a></p>

<h2>About üëã</h2>

<p>Onyx::REST is an opinionated REST API framework build on top of <a href="https://github.com/onyxframework/http" target="_blank">Onyx::HTTP</a>. It provides modules to build scalabale applications, such as <a href="https://api.onyxframework.org/rest/Onyx/REST/Action.html" target="_blank"><code>Action</code></a> and <a href="https://api.onyxframework.org/rest/Onyx/REST/View.html" target="_blank"><code>View</code></a>.</p>

<h2>Installation üì•</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  onyx-rest:
    github: onyxframework/rest
    version: ~> 0.6.3</code></pre>

<p>This shard follows <a href="http://semver.org/" target="_blank">Semantic Versioning v2.0.0</a>, so check <a href="https://github.com/onyxframework/rest/releases" target="_blank">releases</a> and change the <code>version</code> accordingly. Please visit <a href="https://github.com/crystal-lang/shards" target="_blank">github.com/crystal-lang/shards</a> to know more about Crystal shards.</p>

<h2>Usage üíª</h2>

<blockquote>‚ö† <strong>Note:</strong> you should make yourself familiar with <a href="https://github.com/onyxframework/http" target="_blank">Onyx::HTTP</a> before using this shard.</blockquote>

<p>Onyx::REST has two main concepts: actions and views. Action is where the business logic takes place, they are essentially REST endpoints. And views take care of rendering.</p>

<h3>Actions</h3>

<p><a href="https://api.onyxframework.org/rest/Onyx/REST/Action.html" target="_blank"><code>Action</code></a> is a module and can be included into any object. Structs works nice, because actions do not need to reference each other, they are throw-away objects. There is no enforced one-to-one relation between actions and endpoints. Multiple endpoints can execute a single Action, and vice-versa. Let's define a simple action:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx-rest&quot;</span>

<span class="k">struct</span> <span class="t">Hello</span>
  <span class="k">include</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Action</span>

  <span class="k">def</span> <span class="m">call</span>
    context.response <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello Onyx&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

router <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Router</span>.<span class="k">new</span> <span class="k">do</span>
  get <span class="s">&quot;/&quot;</span>, <span class="t">Hello</span>
<span class="k">end</span>

server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>(router)
server.bind_tcp(<span class="n">5000</span>)
server.listen</code></pre>

<pre><code class="language-sh">> curl http://localhost:5000
Hello Onyx</code></pre>

<p>Actions have access to the current <a href="https://crystal-lang.org/api/0.27.2/HTTP/Server/Context.html" target="_blank"><code>HTTP::Server::Context</code></a> via <code>#context</code> getter. They also have have <code>#status</code>, <code>#header</code> and <code>#redirect</code> shortcuts.</p>

<h4>Params</h4>

<p>You can easily define strongly-typed parameters in Actions to enable it parsing incoming values from the HTTP request path, query and also form and JSON bodies. Nested and array params are supported as well.</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx-rest&quot;</span>

<span class="k">struct</span> <span class="t">Hello</span>
  <span class="k">include</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Action</span>

  params <span class="k">do</span>
    query <span class="k">do</span>
      <span class="k">type</span> who : <span class="t">String</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">call</span>
    context.response <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello </span><span class="i">#{</span>params.query.who<span class="i">}</span><span class="s">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>

router <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Router</span>.<span class="k">new</span> <span class="k">do</span>
  get <span class="s">&quot;/&quot;</span>, <span class="t">Hello</span>
<span class="k">end</span>

server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>(router)
server.bind_tcp(<span class="n">5000</span>)
server.listen</code></pre>

<pre><code class="language-sh">> curl http://localhost:5000/?who=World
Hello World</code></pre>

<p>This feature is proudly powered by <a href="https://github.com/vladfaust/http-params-serializable" target="_blank">HTTP::Params::Serializable</a> shard. Read more about <code>.params</code> macro in <a href="https://api.onyxframework.org/rest/Onyx/REST/Action.html" target="_blank">API docs</a>.</p>

<h4>Errors</h4>

<p>It's typical for web applications to have <em>expected errors</em>, e.g. "User is not found". Actions have syntax to define such errors (you'll need an <a href="https://api.onyxframework.org/rest/Onyx/REST/Rescuer.html" target="_blank"><code>Onyx::REST::Rescuer</code></a>):</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx-rest&quot;</span>

<span class="k">struct</span> <span class="t">GetUser</span>
  <span class="k">include</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Action</span>

  params <span class="k">do</span>
    path <span class="k">do</span>
      <span class="k">type</span> id : <span class="t">Int32</span>
    <span class="k">end</span>
  <span class="k">end</span>

  errors <span class="k">do</span>
    <span class="k">type</span> <span class="t">UserNotFound</span>(<span class="n">404</span>)
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">call</span>
    <span class="k">if</span> params.path.id <span class="o">==</span> <span class="n">42</span>
      context.response <span class="o">&lt;&lt;</span> <span class="s">&quot;Found user&quot;</span>
    <span class="k">else</span>
      raise <span class="t">UserNotFound</span>.<span class="k">new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

rescuer <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Rescuer</span>.<span class="k">new</span>

router <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Router</span>.<span class="k">new</span> <span class="k">do</span>
  get <span class="s">&quot;/users/:id&quot;</span>, <span class="t">GetUser</span>
<span class="k">end</span>

server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>(rescuer, router)
server.bind_tcp(<span class="n">5000</span>)
server.listen</code></pre>

<pre><code class="language-sh">> curl http://localhost:5000/users/42
Found user
> curl http://localhost:5000/users/43
404 User Not Found</code></pre>

<h3>Views</h3>

<p><a href="https://api.onyxframework.org/rest/Onyx/REST/View.html" target="_blank"><code>View</code></a> is a module which responsibility is to render responses. A view should be handled by a <em>renderer</em>, which could either be <a href="https://api.onyxframework.org/rest/Onyx/REST/Renderers/Text.html" target="_blank"><code>Onyx::Renderers::Text</code></a> or <a href="https://api.onyxframework.org/rest/Onyx/REST/Renderers/JSON.html" target="_blank"><code>Onyx::Renderers::JSON</code></a>:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx-rest&quot;</span>
<span class="k">require</span> <span class="s">&quot;onyx-rest/renderers/text&quot;</span>

<span class="k">struct</span> <span class="t">UserView</span>
  <span class="k">include</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">View</span>

  <span class="k">def</span> <span class="m">initialize</span>(@id : <span class="t">Int32</span>, @name : <span class="t">String</span>)
  <span class="k">end</span>

  text(<span class="s">&quot;id: </span><span class="i">#{</span>@id<span class="i">}</span><span class="s">, name: </span><span class="i">#{</span>@name<span class="i">}</span><span class="s">&quot;</span>)
<span class="k">end</span>

router <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Router</span>.<span class="k">new</span> <span class="k">do</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>env<span class="o">|</span>
    env.response.view <span class="o">=</span> <span class="t">UserView</span>.<span class="k">new</span>(<span class="n">42</span>, <span class="s">&quot;John&quot;</span>)
  <span class="k">end</span>
<span class="k">end</span>

renderer <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">REST</span><span class="t">::</span><span class="t">Renderers</span><span class="t">::</span><span class="t">Text</span>.<span class="k">new</span>

server <span class="o">=</span> <span class="t">Onyx</span><span class="t">::</span><span class="t">HTTP</span><span class="t">::</span><span class="t">Server</span>.<span class="k">new</span>(router, renderer)
server.bind_tcp(<span class="n">5000</span>)
server.listen</code></pre>

<pre><code class="language-sh">> curl http://localhost:5000
id: 42, name: John</code></pre>

<h3>Actions + Views</h3>

<p>Actions have two native integrations with views. The first one is <code>#view</code> method which sets the response view like this:</p>

<pre><code class="language-crystal">  <span class="k">def</span> <span class="m">call</span>
    view(<span class="t">UserView</span>.<span class="k">new</span>(<span class="n">42</span>, <span class="s">&quot;John&quot;</span>))
  <span class="k">end</span></code></pre>

<p>And the second one is the fact that if an action returns a <code>View</code>, it is then treated as a response view (if not set eariler):</p>

<pre><code class="language-crystal">  <span class="k">def</span> <span class="m">call</span>
    <span class="k">return</span> <span class="t">UserView</span>.<span class="k">new</span>(<span class="n">42</span>, <span class="s">&quot;John&quot;</span>)
  <span class="k">end</span></code></pre>

<p>or, for a prettier control flow:</p>

<pre><code class="language-crystal">  <span class="k">def</span> <span class="m">call</span>
    <span class="k">return</span> <span class="t">UserView</span>.<span class="k">new</span>(<span class="n">42</span>, <span class="s">&quot;John&quot;</span>) <span class="k">if</span> something
    some_code
    <span class="k">return</span> <span class="t">AnotherView</span>.<span class="k">new</span>
  <span class="k">end</span></code></pre>

<h3>Macros</h3>

<p>You should use <code>"onyx/rest"</code> instead of <code>"onyx/http"</code> to enable <a href="https://api.onyxframework.org/rest/Onyx/REST/Rescuer.html" target="_blank"><code>Onyx::REST::Rescuer</code></a> and an ability to enable a renderer in one line:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;onyx/rest&quot;</span>

<span class="t">Onyx</span>.render(<span class="n">:json</span>)
<span class="t">Onyx</span>.listen</code></pre>

<p>Read more about Onyx::HTTP macros at <a href="https://github.com/onyxframework/onyx#http" target="_blank"><strong>@onyxframework/onyx#http</strong></a> or at <a href="https://github.com/onyxframework/http#macros" target="_blank"><strong>@onyxframework/http#macros</strong></a>.</p>

<h2>Community üç™</h2>

<p>There are multiple places to talk about this particular shard and about other ones as well:</p>

<ul><li><a href="https://gitter.im/onyxframework/rest" target="_blank">Onyx::REST Gitter chat</a></li><li><a href="https://gitter.im/onyxframework" target="_blank">Onyx Framework Gitter community</a></li><li><a href="https://gitter.im/vladfaust" target="_blank">Vlad Faust Gitter community</a></li><li><a href="https://twitter.com/onyxframework" target="_blank">Onyx Framework Twitter</a></li><li><a href="https://telegram.me/onyxframework" target="_blank">Onyx Framework Telegram channel</a></li></ul>

<h2>Support ‚ù§Ô∏è</h2>

<p>This shard is maintained by me, <a href="https://vladfaust.com" target="_blank">Vlad Faust</a>, a passionate developer with years of programming and product experience. I love creating Open-Source and I want to be able to work full-time on Open-Source projects.</p>

<p>I will do my best to answer your questions in the free communication channels above, but if you want prioritized support, then please consider becoming my patron. Your issues will be labeled with your patronage status, and if you have a sponsor tier, then you and your team be able to communicate with me in private or semi-private channels such as e-mail and <a href="https://twist.com" target="_blank">Twist</a>. There are other perks to consider, so please, don't hesistate to check my Patreon page:</p>

<p>&lt;a href="https://www.patreon.com/vladfaust">&lt;img height="50" src="https://onyxframework.org/img/patreon-button.svg">&lt;/a></p>

<p>You could also help me a lot if you leave a star to this GitHub repository and spread the world about Crystal and Onyx! üì£</p>

<h2>Contributing</h2>

<ol><li>Fork it ( https://github.com/onyxframework/http/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'feat: some feature') using <a href="https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit" target="_blank">Angular style commits</a></li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/vladfaust" target="_blank">Vlad Faust</a> - creator and maintainer</li></ul>

<h2>Licensing</h2>

<p>This software is licensed under <a href="LICENSE" target="_blank">MIT License</a>.</p>

<p><a href="https://opensource.org/licenses/MIT" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Opensource.svg/100px-Opensource.svg.png" alt="Open Source Initiative"/></a></p>
</div>
</body>
</html>
